<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title>IP Risk Review Report</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <style>
        :root {
            --legal-navy: #1e2a3a;
            --legal-burgundy: #8b2635;
            --legal-gold: #c8a951;
            --legal-ivory: #f8f5f0;
        }
        /* Risk Meter Styles */
        .risk-meter {
            height: 12px;
            border-radius: 6px;
            background: linear-gradient(90deg, #10b981 0%, #f59e0b 50%, #ef4444 100%);
            overflow: hidden;
            position: relative;
        }

        .risk-indicator {
            position: absolute;
            top: -2px;
            width: 4px;
            height: 16px;
            background-color: #1f2937;
            border-radius: 2px;
            transform: translateX(-50%);
            transition: left 0.5s ease;
        }

        .risk-level-low { color: #10b981; }
        .risk-level-medium { color: #f59e0b; }
        .risk-level-high { color: #ef4444; }
        .risk-level-critical { color: #7c2d12; }

        .risk-card {
            transition: all 0.3s ease;
            border-left-width: 4px;
        }

        .risk-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .risk-card.low { border-left-color: #10b981; }
        .risk-card.medium { border-left-color: #f59e0b; }
        .risk-card.high { border-left-color: #ef4444; }
        .risk-card.critical { border-left-color: #7c2d12; }

        /* Deal Value Impact */
        .value-impact {
            position: relative;
            height: 120px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        .value-bar {
            width: 40px;
            border-radius: 4px 4px 0 0;
            transition: all 0.3s ease;
        }
        /* Risk timeline */
        .timeline {
            position: relative;
            padding-left: 2rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0.75rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #e5e7eb;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -2rem;
            top: 0.25rem;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            background-color: #3b82f6;
            border: 2px solid white;
            box-shadow: 0 0 0 2px #3b82f6;
        }

        .timeline-item.critical::before {
            background-color: #ef4444;
            box-shadow: 0 0 0 2px #ef4444;
        }

        .timeline-item.high::before {
            background-color: #f59e0b;
            box-shadow: 0 0 0 2px #f59e0b;
        }

        .timeline-item.medium::before {
            background-color: #10b981;
            box-shadow: 0 0 0 2px #10b981;
        }

        /* Deal info header */
        .deal-header {
            background: linear-gradient(135deg, #2c3b4e 0%, #37516d 100%);
            color: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
        }
        .legal-border {
            border-left: 4px solid var(--legal-burgundy);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Document Editor Styles */
        .document-container {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid #e2e8f0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .document-container:hover {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .document-header {
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            padding: 20px 24px;
        }

        .document-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .action-btn.primary {
            background: var(--legal-burgundy);
            color: white;
            border: none;
        }

        .action-btn.primary:hover {
            background: #7a1e2c;
            transform: translateY(-1px);
        }

        .action-btn.secondary {
            background: white;
            color: var(--legal-navy);
            border: 1px solid #cbd5e1;
        }

        .action-btn.secondary:hover {
            background: #f1f5f9;
            border-color: #94a3b8;
        }

        .action-btn.tertiary {
            background: transparent;
            color: var(--legal-navy);
            border: 1px solid transparent;
        }

        .action-btn.tertiary:hover {
            background: #f1f5f9;
        }

        /* Quill Editor Customization */
        #editor-container {
            height: 500px;
            background: white;
        }

        .ql-toolbar.ql-snow {
            border: none;
            border-bottom: 1px solid #e2e8f0;
            padding: 16px 24px;
            background: #f8fafc;
        }

        .ql-container.ql-snow {
            border: none;
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            line-height: 1.6;
        }

        .ql-editor {
            padding: 32px 48px;
            color: #334155;
        }

        .ql-editor.ql-blank::before {
            font-style: normal;
            color: #94a3b8;
            left: 48px;
        }

        .ql-editor h1, .ql-editor h2, .ql-editor h3 {
            font-family: 'Playfair Display', serif;
            color: var(--legal-navy);
            margin-top: 24px;
            margin-bottom: 16px;
        }

        .ql-editor h1 {
            font-size: 28px;
            font-weight: 700;
            border-bottom: 2px solid var(--legal-gold);
            padding-bottom: 8px;
        }

        .ql-editor h2 {
            font-size: 22px;
            font-weight: 600;
        }

        .ql-editor h3 {
            font-size: 18px;
            font-weight: 500;
        }

        .ql-editor p {
            margin-bottom: 16px;
        }

        .ql-editor blockquote {
            border-left: 4px solid var(--legal-burgundy);
            padding-left: 20px;
            margin-left: 0;
            font-style: italic;
            color: #475569;
        }

        .ql-editor ul, .ql-editor ol {
            padding-left: 24px;
            margin-bottom: 16px;
        }

        .ql-editor .ql-indent-1 {
            padding-left: 48px;
        }

        /* Risk Indicators */
        .risk-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .risk-high {
            background-color: #ef4444;
        }

        .risk-medium {
            background-color: #f59e0b;
        }

        .risk-low {
            background-color: #10b981;
        }

        .risk-critical {
            background-color: #7c2d12;
        }

        /* Legal Seal */
        .legal-seal {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            border: 3px solid var(--legal-burgundy);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 0 auto 32px;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .legal-seal-text {
            font-size: 13px;
            font-weight: bold;
            text-align: center;
            color: var(--legal-navy);
            line-height: 1.3;
            font-family: 'Playfair Display', serif;
        }

        .legal-seal-icon {
            font-size: 28px;
            color: var(--legal-burgundy);
            margin-bottom: 10px;
        }

        /* Document Properties */
        .property-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .property-card:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
        }

        .property-card h3 {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            font-weight: 600;
            color: var(--legal-navy);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        /* Risk Summary Cards */
        .risk-summary-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid #e2e8f0;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .risk-summary-card:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }

        .risk-meter {
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, #10b981 0%, #f59e0b 50%, #ef4444 100%);
            margin-top: 8px;
            position: relative;
        }

        .risk-indicator-marker {
            position: absolute;
            top: -2px;
            width: 4px;
            height: 12px;
            background-color: #1f2937;
            border-radius: 2px;
            transform: translateX(-50%);
        }

        /* Progress Bar */
        .progress-bar {
            height: 6px;
            background-color: #e5e7eb;
            border-radius: 3px;
            overflow: hidden;
            margin-top: 8px;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--legal-burgundy);
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        @media (max-width: 768px) {
            .document-actions {
                flex-direction: column;
                width: 100%;
            }

            .action-btn {
                width: 100%;
                justify-content: center;
            }

            .ql-editor {
                padding: 24px;
            }

            .ql-toolbar.ql-snow {
                padding: 12px 16px;
            }
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        /* Save and Continue Button */
        .save-continue-btn {
            background: #8b2635;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.2s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .save-continue-btn:hover {
            background: #7a1e2c;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 38, 53, 0.3);
        }

        /* Upload Section Styles */
        .upload-dropzone {
            border: 2px dashed #cbd5e0;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            background-color: #f9fafb;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
        }

        .upload-dropzone.active {
            border-color: #9b2f2f;
            background-color: #fdf5f5;
        }

        .upload-icon {
            font-size: 3rem;
            color: #9b2f2f;
            margin-bottom: 1rem;
        }

        .bulk-upload-info {
            background-color: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .upload-summary {
            background-color: #f0fdf4;
            border: 1px solid #bbf7d0;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }

        .document-types-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .document-type-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            text-align: center;
            transition: all 0.2s ease;
        }

        .document-type-card:hover {
            border-color: #9b2f2f;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .document-type-icon {
            font-size: 2rem;
            color: #9b2f2f;
            margin-bottom: 0.5rem;
        }

        /* File Preview Styles */
        .file-preview {
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            background-color: white;
            transition: all 0.2s ease;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .file-preview:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .file-icon {
            font-size: 2rem;
            color: #6b7280;
        }

        .file-icon.pdf {
            color: #dc2626;
        }

        .file-icon.doc {
            color: #2563eb;
        }

        .file-icon.img {
            color: #059669;
        }

        .file-icon.zip {
            color: #7c3aed;
        }

        /* Utility classes */
        .bg-white { background-color: white; }
        .rounded-xl { border-radius: 0.75rem; }
        .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
        .border { border-width: 1px; }
        .border-gray-200 { border-color: #e5e7eb; }
        .p-6 { padding: 1.5rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .lg\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        .gap-4 { gap: 1rem; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .sm\:flex-row { flex-direction: row; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-4 { gap: 1rem; }
        .text-2xl { font-size: 1.5rem; }
        .lg\:text-3xl { font-size: 1.875rem; }
        .font-bold { font-weight: 700; }
        .text-\[\#1e2a3a\] { color: #1e2a3a; }
        .text-gray-600 { color: #4b5563; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-gray-500 { color: #6b7280; }
        .inline-flex { display: inline-flex; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .rounded-full { border-radius: 9999px; }
        .bg-blue-100 { background-color: #dbeafe; }
        .text-blue-800 { color: #1e40af; }
        .bg-amber-100 { background-color: #fef3c7; }
        .text-amber-800 { color: #92400e; }
        .bg-purple-100 { background-color: #e9d5ff; }
        .text-purple-800 { color: #5b21b6; }
        .text-lg { font-size: 1.125rem; }
        .font-semibold { font-weight: 600; }
        .text-red-600 { color: #dc2626; }
        .text-red-700 { color: #b91c1c; }
        .text-blue-700 { color: #1d4ed8; }
        .text-green-700 { color: #15803d; }
        .bg-red-100 { background-color: #fee2e2; }
        .text-red-800 { color: #991b1b; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .p-4 { padding: 1rem; }
        .border-red-200 { border-color: #fecaca; }
        .bg-red-50 { background-color: #fef2f2; }
        .text-gray-900 { color: #111827; }
        .text-xs { font-size: 0.75rem; }
        .mx-2 { margin-left: 0.5rem; margin-right: 0.5rem; }
        .border-amber-200 { border-color: #fde68a; }
        .bg-amber-50 { background-color: #fffbeb; }
        .w-full { width: 100%; }
        .border-gray-300 { border-color: #d1d5db; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .focus\:outline-none:focus { outline: 2px solid transparent; outline-offset: 2px; }
        .focus\:ring-2:focus { box-shadow: 0 0 0 2px rgba(139, 38, 53, 0.5); }
        .focus\:ring-\[\#8b2635\]:focus { --tw-ring-color: #8b2635; }
        .hidden { display: none; }
        .max-h-60 { max-height: 15rem; }
        .overflow-y-auto { overflow-y: auto; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .cursor-pointer { cursor: pointer; }
        .transition-colors { transition-property: color, background-color, border-color; transition-duration: 150ms; }
        .duration-200 { transition-duration: 200ms; }
    </style>
</head>
<body>
<!-- Main Content Area -->
<main layout:fragment="content">
    <!-- Document Upload Form -->
    <form th:action="@{/tasks/complete/{taskId}(taskId=${taskId})}" method="post"
          id="requirementForm" enctype="multipart/form-data">
        <!-- Document Header -->
        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200 mb-6 animate-fade-in">
            <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                <div>
                    <h1 class="text-2xl lg:text-3xl font-bold text-[#1e2a3a] legal-font">IP Risk Review Report</h1>
                    <p class="text-gray-600 mt-2">Client: Tech Innovations Inc. | Matter ID: IP-2023-0042</p>
                    <div class="flex items-center mt-3">
                        <div class="flex items-center text-sm text-gray-500">
                            <i class="fas fa-robot mr-1 text-[#8b2635]"></i>
                            <span>AI-Generated Risk Analysis based on uploaded IP documents</span>
                        </div>
                    </div>
                </div>
                <div class="mt-4 lg:mt-0">
                    <div class="flex flex-col xs:flex-row gap-2">
                                <span class="inline-flex items-center px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm">
                                    <i class="fas fa-copyright mr-1"></i>
                                    Patent Portfolio
                                </span>
                        <span class="inline-flex items-center px-3 py-1 rounded-full bg-amber-100 text-amber-800 text-sm">
                                    <i class="fas fa-exclamation-triangle mr-1"></i>
                                    Risk Review
                                </span>
                        <span class="inline-flex items-center px-3 py-1 rounded-full bg-purple-100 text-purple-800 text-sm">
                                    <i class="fas fa-clock mr-1"></i>
                                    In Progress
                                </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Risk Summary -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="risk-summary-card">
                <div class="flex justify-between items-start">
                    <h3 class="text-lg font-semibold text-[#1e2a3a]">Overall Risk Score</h3>
                    <span class="text-xs font-medium px-2 py-1 rounded-full bg-red-100 text-red-800">High Risk</span>
                </div>
                <div class="mt-4">
                    <div class="text-3xl font-bold text-red-600">72/100</div>
                    <div class="risk-meter">
                        <div class="risk-indicator-marker" style="left: 72%;"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>Low</span>
                        <span>Medium</span>
                        <span>High</span>
                        <span>Critical</span>
                    </div>
                </div>
            </div>

            <div class="risk-summary-card">
                <div class="flex justify-between items-start">
                    <h3 class="text-lg font-semibold text-[#1e2a3a]">Critical Issues</h3>
                    <span class="text-xs font-medium px-2 py-1 rounded-full bg-red-100 text-red-800">4 Issues</span>
                </div>
                <div class="mt-4">
                    <div class="text-3xl font-bold text-red-700">4</div>
                    <p class="text-sm text-gray-600 mt-2">Require immediate resolution</p>
                </div>
            </div>

            <div class="risk-summary-card">
                <div class="flex justify-between items-start">
                    <h3 class="text-lg font-semibold text-[#1e2a3a]">Documents Analyzed</h3>
                    <span class="text-xs font-medium px-2 py-1 rounded-full bg-blue-100 text-blue-800">12 Files</span>
                </div>
                <div class="mt-4">
                    <div class="text-3xl font-bold text-blue-700">12</div>
                    <p class="text-sm text-gray-600 mt-2">Patents, trademarks & agreements</p>
                </div>
            </div>

            <div class="risk-summary-card">
                <div class="flex justify-between items-start">
                    <h3 class="text-lg font-semibold text-[#1e2a3a]">Review Progress</h3>
                    <span class="text-xs font-medium px-2 py-1 rounded-full bg-green-100 text-green-800">65%</span>
                </div>
                <div class="mt-4">
                    <div class="text-3xl font-bold text-green-700">65%</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 65%;"></div>
                    </div>
                    <p class="text-sm text-gray-600 mt-2">Completion status</p>
                </div>
            </div>
        </div>

        <!-- Document Upload Section -->
        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200 mb-6">
            <h2 class="text-xl font-bold text-[#1e2a3a] mb-4">Upload Additional IP Documents</h2>

            <!-- Document Types Overview -->
            <div class="mb-6 p-4 bg-gray-50 rounded-lg">
                <h3 class="font-medium text-[#1e2a3a] mb-3">Document Types We'll Automatically Identify</h3>
                <p class="text-sm text-gray-600 mb-4">Our system will scan and categorize your documents into the following types:</p>

                <div class="document-types-grid">
                    <div class="document-type-card">
                        <div class="document-type-icon">
                            <i class="fas fa-copyright"></i>
                        </div>
                        <div class="text-sm font-medium">Patents</div>
                    </div>
                    <div class="document-type-card">
                        <div class="document-type-icon">
                            <i class="fas fa-trademark"></i>
                        </div>
                        <div class="text-sm font-medium">Trademarks</div>
                    </div>
                    <div class="document-type-card">
                        <div class="document-type-icon">
                            <i class="fas fa-file-contract"></i>
                        </div>
                        <div class="text-sm font-medium">Licenses</div>
                    </div>
                    <div class="document-type-card">
                        <div class="document-type-icon">
                            <i class="fas fa-handshake"></i>
                        </div>
                        <div class="text-sm font-medium">Agreements</div>
                    </div>
                </div>
            </div>

            <!-- File Upload Section -->
            <div>
                <label class="block text-sm font-medium text-[#1e2a3a] mb-3">Upload Additional IP Documents</label>

                <!-- Dropzone -->
                <div id="uploadDropzone" class="upload-dropzone">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <h3 class="text-lg font-medium text-[#1e2a3a] mb-2">Drag & Drop IP Files Here</h3>
                    <p class="text-gray-500 mb-4">or click to browse and select multiple files</p>
                    <p class="text-xs text-gray-400">Supports PDF, DOC, DOCX, XLS, XLSX, JPG, PNG, ZIP (Max 50MB each)</p>
                    <input type="file" id="fileInput" class="hidden" multiple>
                </div>

                <!-- File Preview Area -->
                <div id="filePreviewArea" class="mt-4 space-y-3 hidden">
                    <div class="flex justify-between items-center">
                        <h4 class="text-sm font-medium text-[#1e2a3a]">Selected Files (<span id="fileCount">0</span>)</h4>
                        <button type="button" id="clearFiles" class="text-sm text-[#8b2635] hover:text-[#7a1e2c]">Clear All</button>
                    </div>
                    <div id="fileList" class="space-y-3 max-h-60 overflow-y-auto">
                        <!-- File previews will be added here dynamically -->
                    </div>
                </div>
            </div>

            <!-- Upload Summary -->
            <div id="uploadSummary" class="upload-summary hidden">
                <h4 class="font-medium text-green-900 mb-2">Ready to Upload Documents</h4>
                <p class="text-sm text-green-800">You've selected <span id="summaryFileCount">0</span> documents for upload. These will be automatically categorized and organized after submission.</p>
            </div>
        </div>

        <!-- Document Editor -->
        <div class="document-container mb-6">
            <div class="document-header">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                    <div class="flex items-center gap-4">
                        <h3 class="text-lg font-semibold text-[#1e2a3a] legal-font">AI Risk Analysis Report</h3>
                        <div class="flex items-center text-gray-500 text-sm">
                            <i class="fas fa-circle text-green-500 mr-1 text-xs"></i>
                            <span>Auto-saved: <span id="lastSaved">Just now</span></span>
                        </div>
                    </div>

                    <div class="document-actions">
                        <button class="action-btn primary" id="downloadBtn">
                            <i class="fas fa-download"></i>
                            Download PDF
                        </button>
                    </div>
                </div>
            </div>

            <!-- Quill Editor -->
            <div id="editor-container">
                <!-- Quill toolbar and editor will be inserted here -->
            </div>
        </div>

        <!-- Risk Details and Actions -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- Critical Risks -->
            <div class="lg:col-span-2 property-card">
                <h3>Critical IP Risks Identified</h3>
                <div class="space-y-4">
                    <div class="p-4 border border-red-200 rounded-lg bg-red-50">
                        <div class="flex items-start">
                            <span class="risk-indicator risk-critical mt-1"></span>
                            <div>
                                <h4 class="font-semibold text-gray-900">Patent Infringement Claim</h4>
                                <p class="text-sm text-gray-700 mt-1">Potential infringement of U.S. Patent 9,876,543 "Advanced Data Encryption" by TechSecure Inc.</p>
                                <div class="flex items-center mt-2 text-xs text-gray-600">
                                    <i class="fas fa-dollar-sign mr-1"></i>
                                    <span>Potential liability: $12M</span>
                                    <span class="mx-2">•</span>
                                    <i class="fas fa-clock mr-1"></i>
                                    <span>Resolution: 30 days</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="p-4 border border-red-200 rounded-lg bg-red-50">
                        <div class="flex items-start">
                            <span class="risk-indicator risk-critical mt-1"></span>
                            <div>
                                <h4 class="font-semibold text-gray-900">Ownership Gap in Key Patent</h4>
                                <p class="text-sm text-gray-700 mt-1">Former employee claiming ownership of "Cloud Storage Optimization" patent (US 10,123,456).</p>
                                <div class="flex items-center mt-2 text-xs text-gray-600">
                                    <i class="fas fa-dollar-sign mr-1"></i>
                                    <span>Value at risk: $8M</span>
                                    <span class="mx-2">•</span>
                                    <i class="fas fa-clock mr-1"></i>
                                    <span>Resolution: 45 days</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="p-4 border border-amber-200 rounded-lg bg-amber-50">
                        <div class="flex items-start">
                            <span class="risk-indicator risk-high mt-1"></span>
                            <div>
                                <h4 class="font-semibold text-gray-900">Trademark Transfer Restrictions</h4>
                                <p class="text-sm text-gray-700 mt-1">"TechInnovate" trademark has regional licensing limitations that may impact global acquisition.</p>
                                <div class="flex items-center mt-2 text-xs text-gray-600">
                                    <i class="fas fa-dollar-sign mr-1"></i>
                                    <span>Value impact: $5M</span>
                                    <span class="mx-2">•</span>
                                    <i class="fas fa-clock mr-1"></i>
                                    <span>Resolution: 60 days</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Document Properties -->
            <div class="property-card">
                <h3>Review Properties</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Reviewer</label>
                        <input type="text" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#8b2635] bg-white" value="Robert Kensington">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Review Date</label>
                        <input type="date" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#8b2635] bg-white" value="2023-10-15">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Next Review</label>
                        <input type="date" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#8b2635] bg-white" value="2023-11-15">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                        <select class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-[#8b2635] bg-white">
                            <option>In Review</option>
                            <option>Pending Client Response</option>
                            <option>Escalated</option>
                            <option>Completed</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Save and Continue Section -->
        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-200">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h3 class="text-lg font-semibold text-[#1e2a3a] legal-font">Complete Risk Review</h3>
                    <p class="text-gray-600 mt-1">Save your analysis and proceed to the next task</p>
                </div>
                <div class="flex gap-3">
                    <button type="submit" class="save-continue-btn" id="saveContinueBtn">
                        <i class="fas fa-save"></i>
                        Save & Continue
                    </button>
                </div>
            </div>
        </div>
    </form>

    <script>
        // Initialize Quill editor
        const quill = new Quill('#editor-container', {
            modules: {
                toolbar: [
                    [{ 'header': [1, 2, 3, false] }],
                    ['bold', 'italic', 'underline'],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    [{ 'indent': '-1'}, { 'indent': '+1' }],
                    ['blockquote'],
                    ['link'],
                    [{ 'align': [] }],
                    ['clean']
                ]
            },
            placeholder: 'Compose your risk analysis report...',
            theme: 'snow'
        });

        // Set initial content
        const initialContent = `
            <div class="legal-seal">
                <div class="legal-seal-icon">
                    <i class="fas fa-scale-balanced"></i>
                </div>
                <div class="legal-seal-text">
                    KENSINGTON & PARTNERS<br>
                    ATTORNEYS AT LAW
                </div>
            </div>

            <h1>INTELLECTUAL PROPERTY RISK ANALYSIS REPORT</h1>

            <p><strong>Client:</strong> Tech Innovations Inc.</p>
            <p><strong>Matter ID:</strong> IP-2023-0042</p>
            <p><strong>Review Date:</strong> October 15, 2023</p>
            <p><strong>Prepared By:</strong> LegisForge AI Risk Analysis System</p>

            <h2>EXECUTIVE SUMMARY</h2>

            <p>This report presents a comprehensive risk analysis of the intellectual property portfolio of Tech Innovations Inc., based on the documents uploaded to our system. Our AI-powered analysis has identified several areas of concern that require immediate attention.</p>

            <p>The overall risk score for this IP portfolio is <strong>72/100</strong>, indicating a <strong>High Risk</strong> classification. Four critical issues have been identified that could significantly impact the valuation and transferability of the IP assets.</p>

            <h2>CRITICAL RISK FINDINGS</h2>

            <h3>1. Patent Infringement Risk</h3>

            <p><span class="risk-indicator risk-critical" style="display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; background-color: #7c2d12;"></span> <strong>Severity: Critical</strong></p>

            <p>The "Advanced Data Encryption" technology appears to potentially infringe upon U.S. Patent 9,876,543 held by TechSecure Inc. This represents a significant liability risk with estimated potential damages of $12M.</p>

            <blockquote>
                <strong>Recommendation:</strong> Immediate legal review of claim scope and potential design-around options. Consider initiating licensing negotiations with TechSecure Inc.
            </blockquote>

            <h3>2. Ownership Dispute Risk</h3>

            <p><span class="risk-indicator risk-critical" style="display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; background-color: #7c2d12;"></span> <strong>Severity: Critical</strong></p>

            <p>The ownership chain for the "Cloud Storage Optimization" patent (US 10,123,456) appears incomplete. A former employee is claiming inventor rights and potential ownership interest.</p>

            <blockquote>
                <strong>Recommendation:</strong> Conduct thorough investigation of employment agreements and invention assignment documents. Consider settlement negotiations with the former employee.
            </blockquote>

            <h3>3. Trademark Transfer Restrictions</h3>

            <p><span class="risk-indicator risk-high" style="display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-right: 8px; background-color: #ef4444;"></span> <strong>Severity: High</strong></p>

            <p>The "TechInnovate" trademark registration includes geographical limitations that may prevent global transfer and utilization following acquisition.</p>

            <blockquote>
                <strong>Recommendation:</strong> Review licensing agreements and consider filing for international trademark protection in key markets.
            </blockquote>

            <h2>MITIGATION STRATEGY</h2>

            <p>Based on the identified risks, we recommend the following action plan:</p>

            <ol>
                <li><strong>Immediate (0-30 days):</strong> Resolve patent infringement claim through licensing or design-around</li>
                <li><strong>Short-term (30-60 days):</strong> Clarify ownership of disputed patent through legal documentation</li>
                <li><strong>Medium-term (60-90 days):</strong> Address trademark transfer limitations through agreement modifications</li>
            </ol>

            <h2>CONCLUSION</h2>

            <p>While Tech Innovations Inc. possesses valuable intellectual property assets, the identified risks present significant challenges to acquisition and valuation. Prompt and decisive action is required to mitigate these risks before proceeding with any transaction.</p>

            <p>This analysis was generated by LegisForge AI based on the documents provided. Legal professionals should verify all findings before taking action.</p>
        `;

        quill.root.innerHTML = initialContent;

        // File Upload Functionality
        document.addEventListener('DOMContentLoaded', function() {
            const submitBtn = document.getElementById('saveContinueBtn');
            const dropzone = document.getElementById('uploadDropzone');
            const fileInput = document.getElementById('fileInput');
            const filePreviewArea = document.getElementById('filePreviewArea');
            const fileList = document.getElementById('fileList');
            const fileCount = document.getElementById('fileCount');
            const summaryFileCount = document.getElementById('summaryFileCount');
            const uploadSummary = document.getElementById('uploadSummary');
            const clearFiles = document.getElementById('clearFiles');
            const form = document.getElementById('requirementForm');

            let uploadedFiles = [];

            // Click on dropzone to trigger file input
            dropzone.addEventListener('click', () => {
                fileInput.click();
            });

            // Handle file selection
            fileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });

            // Drag and drop functionality
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropzone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropzone.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropzone.addEventListener(eventName, unhighlight, false);
            });

            function highlight() {
                dropzone.classList.add('active');
            }

            function unhighlight() {
                dropzone.classList.remove('active');
            }

            dropzone.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }

            function handleFiles(files) {
                if (files.length > 0) {
                    filePreviewArea.classList.remove('hidden');
                    uploadSummary.classList.remove('hidden');

                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        // Avoid duplicates
                        if (!uploadedFiles.some(f => f.name === file.name && f.size === file.size)) {
                            uploadedFiles.push(file);
                            addFilePreview(file);
                        }
                    }

                    updateFileCount();
                }
            }

            function addFilePreview(file) {
                const fileElement = document.createElement('div');
                fileElement.className = 'file-preview';

                const fileType = getFileType(file.name);
                const fileSize = formatFileSize(file.size);

                fileElement.innerHTML = `
                    <div class="flex items-center">
                        <div class="file-icon ${fileType} mr-4">
                            <i class="fas ${getFileIcon(fileType)}"></i>
                        </div>
                        <div>
                            <div class="font-medium text-[#1e2a3a] truncate max-w-xs">${file.name}</div>
                            <div class="text-xs text-gray-500">${fileSize}</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button type="button" class="text-gray-400 hover:text-[#8b2635] transition-colors duration-200 remove-file">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;

                fileList.appendChild(fileElement);

                // Add remove functionality
                const removeButton = fileElement.querySelector('.remove-file');
                removeButton.addEventListener('click', () => {
                    fileElement.remove();
                    uploadedFiles = uploadedFiles.filter(f => f !== file);
                    updateFileCount();

                    if (uploadedFiles.length === 0) {
                        filePreviewArea.classList.add('hidden');
                        uploadSummary.classList.add('hidden');
                    }
                });
            }

            // Clear all files
            clearFiles.addEventListener('click', () => {
                fileList.innerHTML = '';
                uploadedFiles = [];
                filePreviewArea.classList.add('hidden');
                uploadSummary.classList.add('hidden');
                updateFileCount();
            });

            function updateFileCount() {
                fileCount.textContent = uploadedFiles.length;
                summaryFileCount.textContent = uploadedFiles.length;
            }

            // Form submission
            form.addEventListener('submit', function(e) {
                // Disable submit button and show loading state
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Saving...';

                // Note: The form will now submit normally to your Thymeleaf endpoint
                // The button will stay disabled until the page reloads
            });

            function getFileType(filename) {
                const ext = filename.split('.').pop().toLowerCase();
                if (['pdf'].includes(ext)) return 'pdf';
                if (['doc', 'docx'].includes(ext)) return 'doc';
                if (['xls', 'xlsx'].includes(ext)) return 'xls';
                if (['jpg', 'jpeg', 'png', 'gif', 'bmp'].includes(ext)) return 'img';
                if (['zip', 'rar', '7z'].includes(ext)) return 'zip';
                return 'other';
            }

            function getFileIcon(fileType) {
                switch(fileType) {
                    case 'pdf': return 'fa-file-pdf';
                    case 'doc': return 'fa-file-word';
                    case 'xls': return 'fa-file-excel';
                    case 'img': return 'fa-file-image';
                    case 'zip': return 'fa-file-archive';
                    default: return 'fa-file';
                }
            }

            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            // Download functionality
            const downloadBtn = document.getElementById('downloadBtn');
            downloadBtn.addEventListener('click', function() {
                alert('Risk Analysis Report downloaded successfully as PDF!');

                // Update last saved time
                const now = new Date();
                document.getElementById('lastSaved').textContent = now.toLocaleTimeString();
            });

            // Auto-save simulation
            setInterval(function() {
                // In a real application, this would save to a database
                const now = new Date();
                document.getElementById('lastSaved').textContent = now.toLocaleTimeString();
            }, 30000); // Auto-save every 30 seconds
        });
    </script>
</main>
</body>
</html>